# Spec 缺漏分析報告

> 對照來源：`epics.md`、`prd.md`、`ux-design-specification.md`  
> 檢查對象：`00-overview.spec.md`、`01-routing-pages.spec.md`、`02-frontend.spec.md`、`03-backend.spec.md`、`04-api-inferred.spec.md`  
> 產出日期：2026-02-11

---

## 一、總體結論

五份 spec 與三份輸入檔的對應關係良好，多數 FR/Epic/UX 需求已覆蓋。以下為需補強或釐清的缺漏項目。

---

## 二、缺漏清單（依 spec 分類）

### 2.1 00-overview.spec.md

| 項目 | 來源 | 說明 |
|------|------|------|
| Epic 11 運務 APP 範圍邊界 | Epics §Epic 11 | 運務 APP 功能擴增（Epic 11）在 00 中有列 Epic 對應，但「碼頭系統 spec 涵蓋範圍」是否包含運務 APP 端行為，或僅涵蓋後端 API／整合，未明確。建議補充：Epic 11 中由後端負責的整合與 API 屬本 spec 範圍；運務 APP 端 UI/流程屬外部系統。 |
| 設計系統出處 | UX Design §Design System | Element Plus、色彩 token（#8eba34、#3a9cd8、#f68480）等僅見於 UX；00 未引用設計資產來源。可選：在功能模組或技術約束中補一句「前端設計系統依 UX Design Specification」。 |

---

### 2.2 01-routing-pages.spec.md

| 項目 | 來源 | 說明 |
|------|------|------|
| 收貨列表頁 篩選欄位 | PRD §4.1、Epics Story 5.6、UX §收貨列表頁 | PRD 註明收貨列表有「篩選列、可設定篩選條件」，但三份輸入檔皆未列出具體篩選欄位。01 僅寫「篩選列（存在，但欄位細節未在本段落完整列出）」。**建議**：在 01 收貨列表頁補充「篩選欄位：待輸入文件釐清」，避免實作時遺漏。 |
| 公告列表頁 篩選欄位 | PRD §2.1、Epics Story 3.2 | Epics 範例為「日期範圍、已讀/未讀狀態」。01 未列出公告篩選欄位。可補：篩選列（日期範圍、已讀/未讀狀態等，以 Epics 為準）。 |

---

### 2.3 02-frontend.spec.md

| 項目 | 來源 | 說明 |
|------|------|------|
| 收貨明細（入庫分貨）純顯示欄位 | PRD §4.3.1、UX §入庫分貨編輯頁、FR69.9 | 單據入數、單據件數、單據板位應為純顯示。02 §5.4 只列出可編輯欄位，未列純顯示欄位。**缺漏**：應補充「純顯示：單據入數、單據件數、單據板位（來源：運務 APP 配送單起點回報）」。 |
| 入庫分貨實收數量預設值 | PRD §4.3.1 | 「實收數量預設同單據入數」。02 未提及。**缺漏**：應在 §5.4 入庫分貨補上此預設規則。 |
| 收貨明細（越庫作業）純顯示欄位 | PRD §4.3.2、UX §越庫作業編輯頁、FR69.15 | 起點單據板位、迄點單據板位應為純顯示。02 §5.4 越庫作業僅列可編輯欄位。**缺漏**：應補充「純顯示：起點單據板位、迄點單據板位」。 |
| 車次詳細配送單燈箱 配送單展開欄位 | PRD §3.1、UX §車次詳細配送單燈箱 | 各配送單收合展開時應顯示：客戶簡稱、配送單號、聯絡人、電話、配送商品資訊、配送載具資訊、收貨備註（配送起點）、送貨備註（配送迄點）。02 §4.4 僅寫「配送點下可能包含多位客戶的配送單（各自可收合展開）」，未列上述欄位。**缺漏**：應在 §4.4 燈箱結構中補充各配送單顯示欄位。 |
| 收貨列表 篩選欄位 | 同上 01 | 02 §5.1 未列出收貨列表篩選欄位，與 01 問題一致。 |
| 公告列表 篩選欄位 | 同上 01 | 02 §3.1 未列出公告篩選欄位。 |

---

### 2.4 03-backend.spec.md

| 項目 | 來源 | 說明 |
|------|------|------|
| 收貨列表 篩選參數 | PRD FR27、Epics Story 5.6 | 03 §4.1 寫「支援篩選」，未定義篩選參數。若前端需支援篩選，後端 API 須有對應查詢參數。**建議**：於 §4.1 或 §10 未定義區補充「收貨列表篩選欄位：待釐清（可參考倉儲收貨資訊查詢 FR69.1 之子集）」。 |
| 入庫分貨 單據欄位來源 | FR69.10 | 單據入數/件數/板位來源為運務 APP 配送單起點回報。03 §4.2 未明確寫出此資料來源。可選：在收貨明細段落補一句「單據入數/件數/板位由運務 APP 起點回報寫入，唯讀」。 |
| 運務 APP 退貨異常回報 API | PRD §6.2、Epics Story 11.2–11.4 | 運務送出「回廠退／直退」時需有對外 API。03 §5 有描述直退/回廠退流程，但未點出「運務 APP 呼叫之 API」責任。**建議**：在 §5 或整合相關段落補「接收運務 APP 退貨異常回報之 API，依退貨類型觸發不同流程（回廠退→退貨單、直退→配送單自動建立）」。 |

---

### 2.5 04-api-inferred.spec.md

| 項目 | 來源 | 說明 |
|------|------|------|
| 收貨列表 GET 篩選參數 | 同上 03 | 04 收貨列表 API 寫「查詢參數：篩選」，未列具體參數。應註明「篩選參數：待釐清」，或依日後 03 定義補上。 |
| 運務 APP 退貨異常回報 API | PRD §6.2、Epics §11 | 04 未推導運務 APP 送出退貨異常回報的 API（如 `POST /driver/returns/report` 或類似）。**缺漏**：建議新增一列，例如運務 APP 退貨回報 API，並註明觸發回廠退/直退流程。 |
| 車次詳細 配送單欄位 | PRD §3.1 | 04 車次詳細 API 寫「配送點與配送單明細（可收合結構）」，未列出各配送單應含欄位（客戶簡稱、配送單號、聯絡人、電話等）。可於備註或欄位說明中補上，與 02 一致。 |

---

## 三、已正確覆蓋／無需補強

- 出貨作業：篩選列、碼頭儀錶板、未排車次列表、車次燈箱、狀態變更流程
- 收貨作業：三層導航、簽名板、入庫分貨/越庫作業類型判斷、下貨碼頭排除邏輯
- 退貨作業：列表、彙整、編輯/查看、直退/回廠退流程、後台雙向同步
- 即時同步、推播、運務 APP 回廠下貨、後台管理與既有功能擴增
- Epic 1–10 對應、FR 覆蓋範圍
- NFR 性能與安全需求（多數已於 03 與來源文件中對應）

---

## 四、建議修正優先序

| 優先級 | 項目 | 影響 |
|--------|------|------|
| 高 | 收貨明細入庫/越庫純顯示欄位（02） | 影響收貨明細實作完整性 |
| 高 | 入庫分貨實收數量預設（02） | 影響預設值與資料流 |
| 高 | 車次燈箱配送單展開欄位（02、04） | 影響燈箱資訊完整性 |
| 中 | 收貨列表篩選欄位（01、02、03、04） | 影響篩選功能實作與 API 設計 |
| 中 | 運務 APP 退貨異常回報 API（03、04） | 影響運務 APP 與後端整合 |
| 低 | 公告篩選欄位（01、02） | 可從 Epics 範例推論，風險較低 |
| 低 | Epic 11 範圍、設計系統出處（00） | 釐清用，不影響實作 |

---

## 五、名詞與範圍備註

- **入庫作業 vs 收貨作業**：Epics FR66.5 使用「碼頭前台>入庫作業」，PRD/01 使用「收貨作業」，在此脈絡下視為同義。
- **Epic 11（運務 APP）**：本 spec 群聚焦碼頭前台 Web 與後台；運務 APP 端 UI/流程屬外部系統，後端 API 與整合行為屬本 spec 範圍。

---

## 六、Prompt 導致缺漏之原因分析

對照 `docs/prompt/spec-kit-dev-spec.prompt.md` 與 `docs/prompt/spec-kit-task-breakdown.prompt.md`，以下規則與寫法容易導致前述缺漏。

### 6.1 spec-kit-dev-spec.prompt.md

| 規則／寫法 | 為何導致缺漏 |
|------------|----------------|
| **「若資訊不足，請明確標示為『未定義』」** | 當輸入文件有「篩選列、可設定篩選條件」但未列欄位時，Agent 可能選擇不寫、而非寫「篩選欄位：未定義／待釐清」，造成 01／02／03 完全沒提到篩選欄位。 |
| **「不得自行補流程、補頁面、補 API」** | 運務 APP 退貨異常回報在 PRD §6.2、Epics 有流程，但未寫「請在 spec 中列出對外 API」。Agent 只描述流程、不拆出「接收運務 APP 呼叫之 API」責任，導致 03／04 缺該 API。 |
| **02：「不描述元件實作方式」** | 「純顯示欄位」「配送單展開欄位」容易被解讀成元件/實作細節而略過；實則為「顯示什麼」的行為規則，應屬 02 範圍。 |
| **「不重複貼回原始文件全文」** | 為避免照抄，Agent 傾向寫摘要；PRD/UX 的表格（單據入數、單據件數、單據板位；燈箱各配送單欄位）未被系統性轉成 02 的條列，造成欄位級缺漏。 |
| **01 僅要求「包含的功能區塊」** | 未要求「每個功能區塊的欄位級清單」。因此只寫「篩選列、列表」而不寫「篩選欄位：…」，符合現有契約但不足以避免實作遺漏。 |
| **04：「僅以 00–03 為依據推導」** | 04 不得回頭看 PRD/Epics。02 或 03 漏寫的項目（燈箱欄位、運務退貨 API）在 04 無法補回，缺漏形成鏈式效應。 |
| **00：「不包含任何 UI／視覺設計細節」** | 設計系統、色彩 token 被歸類為 UI/視覺，00 因此不引用 UX 設計資產來源，導致「設計系統出處」缺漏。 |
| **未要求「欄位級對齊」** | Prompt 未要求「對 PRD/UX 中每個列表、表格做欄位級對齊（純顯示／可編輯／篩選）」，Agent 易只做概念層整理，漏掉表格式細節。 |

### 6.2 spec-kit-task-breakdown.prompt.md

| 規則／寫法 | 為何導致缺漏 |
|------------|----------------|
| **「不得補齊 Spec 未定義的行為」** | 任務拆分僅能依 Spec；Spec 未寫的欄位或 API，任務端不得自行補上，缺漏會從 Spec 延續到 Task。 |
| **輸入邊界僅 00／01／02／03** | 不讀 PRD/Epics/UX，無法在拆任務時發現「Spec 少寫了 PRD 裡的某段」，無法反向提醒補 Spec。 |

### 6.3 小結：根因歸類

- **轉譯不全**：輸入有寫（PRD/UX 表格、Epics 範例），但 dev-spec 的「不重複、不補、不實作」使 Agent 只做摘要，未做欄位級列舉。
- **邊界解讀過嚴**：「不描述元件實作」被用到「顯示/純顯示欄位」上，導致 02 少寫欄位清單。
- **契約未要求列舉**：01／02 的產出契約未要求「篩選欄位清單」「每區塊純顯示/可編輯欄位」，符合契約仍可漏細節。
- **04 單向依賴**：04 只讀 00–03，03/02 漏寫會直接導致 04 漏 API 或欄位說明。
- **任務拆分不補洞**：task-breakdown 禁止補齊 Spec 未定義行為，缺漏不會在任務階段被修復。

### 6.4 建議的 Prompt 改動方向（可選）

若要降低同類缺漏再發生，可考慮：

1. **spec-kit-dev-spec.prompt.md**
   - 在 01 的「功能區塊」說明中補充：若輸入文件有篩選/搜尋但未列欄位，須寫「篩選（或搜尋）欄位：未定義／待輸入文件釐清」。
   - 在 02 的職責中區分：「顯示/純顯示欄位清單」屬行為與狀態規則，須從 PRD/UX 表格轉譯；僅「元件實作方式」不描述。
   - 在撰寫規則中增加：對 PRD/UX 中明確出現的列表、表格欄位，須在對應 spec 段落做欄位級對齊（可精簡列舉，不必全文照抄）。
   - 在 04 的規則中補充：若 02/03 未寫某行為但 PRD/Epics 有明確流程（如運務 APP 退貨回報），04 可註明「推導依據：PRD §x、Epics §y，建議補入 02/03 後再對應 API」。

2. **spec-kit-task-breakdown.prompt.md**
   - 維持「不得補齊 Spec 未定義行為」；若希望任務階段能發現缺漏，可加：若任務依 Spec 無法寫出明確驗收標準（例如 Spec 僅寫「支援篩選」未列欄位），須在任務備註標示「依 Spec 未定義，驗收前需與 Spec 補齊」。
