---
stepsCompleted: [1, 2, 3, 4]
inputDocuments:
  - '_bmad-output/planning-artifacts/prd.md'
  - '_bmad-output/planning-artifacts/ux-design-specification.md'
  - 'c:\\Users\\TingYi\\Downloads\\Architecture.md'
completedAt: "2026-01-27"
---

# 昶青_碼頭系統 - Epic Breakdown

## Overview

This document provides the complete epic and story breakdown for 昶青_碼頭系統, decomposing the requirements from the PRD, UX Design if it exists, and Architecture requirements into implementable stories.

## Requirements Inventory

### Functional Requirements

FR1: 倉儲人員可以使用後台帳號密碼登入系統
FR2: 系統可以驗證登入憑證，並在驗證失敗時顯示錯誤提示
FR3: 倉儲人員可以查看忘記密碼的相關資訊
FR4: 倉儲人員可以安全登出系統
FR5: 系統可以根據登入人員的內部廠區設定，只顯示符合該廠區的資料
FR6: 系統可以整合後台碼頭人員列表進行身份驗證
FR7: 倉儲人員可以查看公告列表
FR8: 倉儲人員可以篩選公告列表
FR9: 倉儲人員可以標記公告為已讀
FR10: 倉儲人員可以刪除公告
FR11: 倉儲人員可以批量標記公告為已讀（依照篩選條件）
FR12: 倉儲人員可以批量刪除公告（依照篩選條件）
FR13: 倉儲人員可以查看公告詳細內容（日期、時間、標題、內容）
FR14: 系統可以顯示公告的已讀/未讀狀態
FR15: 倉儲人員可以查看碼頭儀錶板，顯示所有碼頭的即時狀態
FR16: 系統可以根據車輛狀態以不同顏色顯示碼頭（綠色：正常、藍色：缺貨待料、紅色：通知未到）
FR17: 倉儲人員可以從未排車次的碼頭下拉選單中選擇符合條件的車輛
FR18: 系統可以根據條件篩選可選車輛（配送日期為當天、任務起點為同廠區、有送貨配送單、尚未完成出車或取消）
FR19: 倉儲人員可以發送通知給選定任務的運務
FR20: 倉儲人員可以查看任務內含的所有配送單資訊
FR21: 倉儲人員可以修改車輛狀態（取消、完成出車、缺貨待料、通知未到）
FR22: 系統可以根據車輛狀態變更自動更新顯示（完成出車/取消的車輛不再顯示，缺貨待料/通知未到的車輛回到未排車次列表）
FR23: 倉儲人員可以篩選未排車次列表
FR24: 系統可以根據篩選條件動態更新未排車次列表
FR25: 系統可以根據車輛狀態以不同顏色顯示未排車次（綠色：正常、紅色：通知未到、藍色：缺貨待料）
FR26: 倉儲人員可以查看收貨列表，顯示所有包含收貨的任務
FR27: 倉儲人員可以篩選收貨列表
FR28: 系統可以追蹤任務的下貨狀態（接貨中、回廠下貨）
FR29: 系統可以接收運務回報的「回廠下貨」狀態，並更新任務狀態
FR30: 系統可以顯示回廠下貨任務的車輛回報位置和時間
FR31: 倉儲人員可以為回廠下貨的任務選擇下貨碼頭
FR32: 系統可以自動排除已選定出貨和下貨的碼頭選項
FR33: 倉儲人員可以從收貨列表進入任務的配送點總表
FR34: 系統可以依照狀態和回報時間排序收貨列表（先回廠下貨再接貨中，同樣狀態依回報時間新到舊）
FR35: 倉儲人員可以查看配送點總表，顯示任務所有有收貨的配送單資訊
FR36: 倉儲人員可以從配送點總表進入收貨明細
FR37: 倉儲人員可以請運務在配送點總表簽名
FR38: 系統可以在運務簽名送出後，將任務收貨狀態更新為已完成
FR39: 系統可以防止已完成收貨的任務再次進入配送點總表
FR40: 倉儲人員可以查看入庫分貨的收貨明細
FR41: 倉儲人員可以查看越庫作業的收貨明細
FR42: 系統可以顯示收貨明細的進入時間並持續動態更新
FR43: 倉儲人員可以查看配送單的商品資訊（客戶簡稱、商品名稱、單據資訊等）
FR44: 倉儲人員可以修改入庫分貨的實收數量
FR45: 倉儲人員可以為入庫分貨的商品新增多組實收數量與有效日期
FR46: 倉儲人員可以刪除入庫分貨商品的多組實收數量與有效日期資料（最少必須保留一組）
FR47: 倉儲人員可以為入庫分貨的商品填寫備註
FR48: 倉儲人員可以修改越庫作業的實收板位
FR49: 倉儲人員可以為越庫作業的商品新增多組配送點、實收板位、配送日期與備註
FR50: 倉儲人員可以刪除越庫作業商品的多組資料（配送點、實收板位、配送日期與備註），最少必須保留一組
FR51: 倉儲人員可以為越庫作業的商品填寫備註
FR52: 倉儲人員可以查看退貨單列表
FR53: 倉儲人員可以篩選退貨單列表
FR54: 系統可以顯示退貨單的關鍵資訊（退貨單號、建立日期、原配送單號、客戶簡稱、退貨類型、狀態）
FR55: 倉儲人員可以編輯狀態為「未完成」的退貨單
FR56: 倉儲人員可以查看狀態為「已立單」的退貨單（唯讀）
FR57: 倉儲人員可以修改退貨單的商品內容（當狀態為未完成時）
FR58: 系統可以整合運務 APP 和後台產生的退貨單資料
FR59: 系統可以即時同步後台操作到前端顯示（< 3 秒）
FR60: 系統可以即時同步前端操作到後台和其他裝置
FR61: 系統可以透過 WebSocket 維持即時連線
FR62: 系統可以在網路中斷時提示使用者
FR63: 系統可以支援多裝置同時監控並保持資料同步
FR64: 系統可以發送推播通知到運務 APP
FR65: 系統可以接收運務 APP 回報的狀態（如回廠下貨）
FR66: 後台管理員可以管理碼頭列表
FR67: 後台管理員可以管理碼頭人員列表
FR68: 後台管理員可以查看退貨單列表
FR69: 後台管理員可以查詢倉儲收貨資訊
FR70: 後台管理員可以同步查看前台資料
FR71: 後台管理員可以修改前台資料（依照權限）
FR72: 系統可以與現有後台系統整合資料
FR73: 系統可以確保與現有系統的資料同步準確率 100%
FR74: 系統可以記錄所有狀態變更操作
FR75: 系統可以追溯所有操作的歷史記錄
FR76: 系統可以驗證資料完整性

### NonFunctional Requirements

NFR1: API 響應時間：95% 請求 < 300ms
NFR2: 頁面載入時間：< 2 秒
NFR3: 互動操作響應時間：< 500ms
NFR4: 篩選與搜尋響應：< 500ms
NFR5: 後台操作反映時間：< 3 秒
NFR6: 狀態變更同步準確率：100%
NFR7: WebSocket 連線穩定性：連線中斷率 < 0.1%
NFR8: 多裝置同步延遲：< 3 秒
NFR9: 碼頭儀錶板狀態更新：延遲 < 3 秒
NFR10: 車輛狀態變更反映：顏色更新即時反映（< 1 秒）
NFR11: 未排車次列表篩選：響應時間 < 500ms
NFR12: 收貨列表排序與篩選：響應時間 < 1 秒
NFR13: 簽名板操作：完成時間 < 10 秒
NFR14: 登入驗證：整合後台帳號密碼驗證系統
NFR15: 會話管理：安全登出功能，會話逾時自動登出
NFR16: 權限控制：整合現有權限系統，保持一致性
NFR17: 操作權限驗證：所有操作都進行權限驗證
NFR18: 廠區資料隔離：登入後只顯示符合該人員內部廠區的資料
NFR19: 資料存取控制：依照人員權限限制操作範圍
NFR20: 資料傳輸安全：所有資料傳輸使用加密（HTTPS/WSS）
NFR21: 敏感資料保護：簽名資料、操作記錄等敏感資訊需加密儲存
NFR22: 操作記錄：記錄所有狀態變更操作
NFR23: 審計日誌：可追溯所有操作的歷史記錄
NFR24: 定期審查：定期審查人員權限設定
NFR25: 系統可用性：> 99.9%（每月停機時間 < 43.2 分鐘）
NFR26: 錯誤率：< 0.1%
NFR27: 系統穩定性：支援多裝置同時監控，具備斷線提示與容錯
NFR28: 與現有系統資料同步準確率：100%
NFR29: 資料遺失率：0%
NFR30: 資料完整性：100%
NFR31: 收貨明細資料儲存：成功率 > 99.9%
NFR32: 網路中斷處理：網路中斷時提示使用者，並在恢復後自動重新連線
NFR33: WebSocket 連線恢復：連線中斷時自動重連，確保資料不遺失
NFR34: 異常處理：提供異常處理流程與異常恢復機制
NFR35: 降級方案：WebSocket 失敗時提供降級方案（如輪詢）
NFR36: 後台系統整合：與現有後台系統完整整合資料
NFR37: 資料同步機制：事件驅動 + WebSocket，確保即時性與可靠性
NFR38: API 整合：RESTful API 設計，支援標準 HTTP 方法
NFR39: 訊息佇列整合：如需要，支援訊息佇列整合
NFR40: 運務 APP 整合：接收運務 APP 回報的狀態（如回廠下貨）
NFR41: 推播通知整合：發送推播通知到運務 APP
NFR42: 資料格式相容：確保與現有系統的資料格式相容
NFR43: 整合穩定性：整合服務可用性 > 99.5%
NFR44: 資料一致性：確保所有整合系統的資料同步一致
NFR45: 錯誤處理：整合失敗時提供錯誤提示與重試機制

### Additional Requirements

**來自 Architecture 的技術需求：**
- Brownfield 專案：擴展現有 Laravel 7.24 系統（148_changching 專案）
- 現有系統架構：Laravel MVC 架構，包含現有的 Controllers、Models、Services、Routes
- 資料庫：MySQL（現有系統使用）
- 快取：Redis（現有系統使用）
- 前端整合：需整合到現有前端架構（frontend_webapp 目錄）
- API 整合：需遵循現有 API 設計模式（TransportApi 等現有 API 結構）
- 權限系統整合：需整合現有權限系統（HasRoles、HasPermissions traits）
- 通知系統整合：需整合現有通知系統（NoticeService、PushServiceProvider）
- 資料模型整合：需與現有 Models 整合（DeliveryOrder、DeliveryTask、Vehicle 等）
- 路由整合：需遵循現有路由結構（routes/modules/ 目錄結構）

**後台既有功能擴增修改：**
- 既有主功能「網站管理」> 次功能「區塊內容管理」，新增「碼頭-忘記密碼」功能，串聯前台忘記密碼顯示設定的提示文字
- 既有主功能「配送點管理」> 次功能「內部廠區」，內部廠區編輯頁新增「入庫分貨配送點燈箱」，可選擇與所選內部廠區關聯的入庫分貨配送點
- 收貨作業內自動判斷配送單迄點是否與登入人員的內部廠區關聯為入庫分貨：若是 → 收貨明細類型為入庫分貨；若否 → 收貨明細類型為越庫作業

**來自 UX Design 的額外需求：**
- 響應式設計：平板優先（768px - 1024px），支援桌面（> 1024px）和手機（< 768px）
- 設計系統：Element Plus（Vue.js 3）
- 前端框架：Vue.js 3（已選擇）
- 觸控友善：所有互動元素至少 44x44px
- 無障礙性：WCAG AA 等級（顏色對比 4.5:1、鍵盤導航、ARIA 標籤）
- 狀態顏色：綠色（#8eba34 - 正常）、藍色（#3a9cd8 - 缺貨待料）、紅色（#f68480 - 通知未到）
- 固定頂部功能列：一橫排顯示（登出、即時公告、出貨作業、收貨作業、退貨作業）
- 碼頭儀錶板：一橫排顯示，純實色背景顯示狀態，不論車輛狀態皆顯示車牌與喇叭 icon
- 車次詳細配送單燈箱：遮罩不覆蓋整個頁面，按鈕在燈箱內最下方，基本資訊區塊（上班時間/司機姓名/車號車次/路線別），配送資訊可收合展開
- 簽名板：觸控繪製，至少 300x150px
- 即時同步視覺回饋：狀態變更動畫（< 1 秒），同步提示
- 離線功能：網路中斷時可暫存操作，恢復後自動同步

### FR Coverage Map

FR1: Epic 2 - 倉儲人員登入系統
FR2: Epic 2 - 登入憑證驗證與錯誤提示
FR3: Epic 2 - 忘記密碼資訊查看
FR4: Epic 2 - 安全登出系統
FR5: Epic 2 - 廠區資料隔離
FR6: Epic 2 - 整合後台碼頭人員列表進行身份驗證
FR7: Epic 3 - 查看公告列表
FR8: Epic 3 - 篩選公告列表
FR9: Epic 3 - 標記公告為已讀
FR10: Epic 3 - 刪除公告
FR11: Epic 3 - 批量標記公告為已讀
FR12: Epic 3 - 批量刪除公告
FR13: Epic 3 - 查看公告詳細內容
FR14: Epic 3 - 顯示公告已讀/未讀狀態
FR15: Epic 4 - 查看碼頭儀錶板即時狀態
FR16: Epic 4 - 根據車輛狀態以不同顏色顯示碼頭
FR17: Epic 4 - 從未排車次碼頭下拉選單選擇車輛
FR18: Epic 4 - 根據條件篩選可選車輛
FR19: Epic 4 - 發送通知給選定任務的運務
FR20: Epic 4 - 查看任務內含的所有配送單資訊
FR21: Epic 4 - 修改車輛狀態
FR22: Epic 4 - 根據車輛狀態變更自動更新顯示
FR23: Epic 4 - 篩選未排車次列表
FR24: Epic 4 - 根據篩選條件動態更新未排車次列表
FR25: Epic 4 - 根據車輛狀態以不同顏色顯示未排車次
FR26: Epic 5 - 查看收貨列表
FR27: Epic 5 - 篩選收貨列表
FR28: Epic 5 - 追蹤任務的下貨狀態
FR29: Epic 5 - 接收運務回報的「回廠下貨」狀態
FR30: Epic 5 - 顯示回廠下貨任務的車輛回報位置和時間
FR31: Epic 5 - 為回廠下貨的任務選擇下貨碼頭（依賴 Epic 1 的碼頭列表）
FR32: Epic 5 - 自動排除已選定出貨和下貨的碼頭選項
FR33: Epic 5 - 從收貨列表進入任務的配送點總表
FR34: Epic 5 - 依照狀態和回報時間排序收貨列表
FR35: Epic 5 - 查看配送點總表
FR36: Epic 5 - 從配送點總表進入收貨明細
FR37: Epic 5 - 請運務在配送點總表簽名
FR38: Epic 5 - 運務簽名送出後更新任務收貨狀態為已完成
FR39: Epic 5 - 防止已完成收貨的任務再次進入配送點總表
FR40: Epic 5 - 查看入庫分貨的收貨明細
FR41: Epic 5 - 查看越庫作業的收貨明細
FR42: Epic 5 - 顯示收貨明細的進入時間並持續動態更新
FR43: Epic 5 - 查看配送單的商品資訊
FR44: Epic 5 - 修改入庫分貨的實收數量
FR45: Epic 5 - 為入庫分貨的商品新增多組實收數量與有效日期
FR46: Epic 5 - 刪除入庫分貨商品的多組實收數量與有效日期資料
FR47: Epic 5 - 為入庫分貨的商品填寫備註
FR48: Epic 5 - 修改越庫作業的實收板位
FR49: Epic 5 - 為越庫作業的商品新增多組配送點、實收板位、配送日期與備註
FR50: Epic 5 - 刪除越庫作業商品的多組資料
FR51: Epic 5 - 為越庫作業的商品填寫備註
FR52: Epic 6 - 查看退貨單列表
FR53: Epic 6 - 篩選退貨單列表
FR54: Epic 6 - 顯示退貨單的關鍵資訊
FR55: Epic 6 - 編輯狀態為「未完成」的退貨單
FR56: Epic 6 - 查看狀態為「已立單」的退貨單（唯讀）
FR57: Epic 6 - 修改退貨單的商品內容
FR58: Epic 6 - 整合運務 APP 和後台產生的退貨單資料
FR59: Epic 7 - 即時同步後台操作到前端顯示
FR60: Epic 7 - 即時同步前端操作到後台和其他裝置
FR61: Epic 7 - 透過 WebSocket 維持即時連線
FR62: Epic 7 - 網路中斷時提示使用者
FR63: Epic 7 - 支援多裝置同時監控並保持資料同步
FR64: Epic 7 - 發送推播通知到運務 APP
FR65: Epic 7 - 接收運務 APP 回報的狀態
FR66: Epic 1 - 後台管理員管理碼頭列表
FR67: Epic 1 - 後台管理員管理碼頭人員列表
FR68: Epic 8 - 後台管理員查看退貨單列表
FR69: Epic 8 - 後台管理員查詢倉儲收貨資訊
FR70: Epic 8 - 後台管理員同步查看前台資料
FR71: Epic 8 - 後台管理員修改前台資料（依照權限）
FR72: Epic 9 - 與現有後台系統整合資料
FR73: Epic 9 - 確保與現有系統的資料同步準確率 100%
FR74: Epic 9 - 記錄所有狀態變更操作
FR75: Epic 9 - 追溯所有操作的歷史記錄
FR76: Epic 9 - 驗證資料完整性

## Epic List

### Epic 1: 後台基礎資料管理（碼頭與人員）

後台管理員可以管理碼頭列表和碼頭人員列表，建立前台作業所需的基礎資料。此 Epic 必須優先完成，因為登入驗證與登入後的頁面顯示資料都依賴這些基礎資料。

**FRs covered:** FR66, FR67

**Implementation Notes:**
- 此 Epic 必須在 Epic 2（身份驗證）之前完成
- 碼頭列表和碼頭人員列表是登入驗證和前台作業的基礎資料
- 需整合現有後台管理架構
- 碼頭人員列表用於 Epic 2 的身份驗證（FR6）
- 碼頭列表用於 Epic 4（出貨作業）和 Epic 5（收貨作業）

### Epic 2: 身份驗證與基礎設定

倉儲人員可以安全登入系統，查看基本資訊，系統根據登入人員的內部廠區設定顯示符合該廠區的資料。

**FRs covered:** FR1, FR2, FR3, FR4, FR5, FR6

**Implementation Notes:**
- 依賴 Epic 1：需要碼頭人員列表進行身份驗證（FR6）
- 整合現有後台碼頭人員列表進行身份驗證
- 廠區資料隔離功能
- 忘記密碼功能需串聯後台「碼頭-忘記密碼」區塊內容管理

### Epic 3: 即時公告管理

倉儲人員可以查看與管理公告，包括篩選、標記已讀、刪除等操作。

**FRs covered:** FR7, FR8, FR9, FR10, FR11, FR12, FR13, FR14

**Implementation Notes:**
- 沿用現有公告系統架構
- 支援批量操作（依照篩選條件）

### Epic 4: 出貨作業管理

倉儲人員可以管理碼頭出貨作業，包括查看碼頭儀錶板、選擇車次、發送通知、修改車輛狀態等完整出貨流程。

**FRs covered:** FR15, FR16, FR17, FR18, FR19, FR20, FR21, FR22, FR23, FR24, FR25

**Implementation Notes:**
- 依賴 Epic 1：需要碼頭列表資料（顯示碼頭儀錶板）
- 依賴 Epic 2：需要登入驗證和廠區資料隔離
- 碼頭儀錶板是核心互動中心
- 需整合即時同步機制（Epic 7）

### Epic 5: 收貨作業管理

倉儲人員可以管理收貨作業，包括查看收貨列表、進入配送點總表、查看收貨明細、請運務簽名等完整收貨流程。

**FRs covered:** FR26, FR27, FR28, FR29, FR30, FR31, FR32, FR33, FR34, FR35, FR36, FR37, FR38, FR39, FR40, FR41, FR42, FR43, FR44, FR45, FR46, FR47, FR48, FR49, FR50, FR51

**Implementation Notes:**
- 依賴 Epic 1：需要碼頭列表資料（選擇下貨碼頭）
- 依賴 Epic 2：需要登入驗證和廠區資料隔離
- 三層架構：收貨列表 → 配送點總表 → 收貨明細
- 自動判斷收貨明細類型（入庫分貨/越庫作業）需依賴後台內部廠區設定的入庫分貨配送點
- 需整合即時同步機制（Epic 7）

### Epic 6: 退貨作業管理

倉儲人員可以查看與管理退貨單，包括篩選、編輯、查看等操作。

**FRs covered:** FR52, FR53, FR54, FR55, FR56, FR57, FR58

**Implementation Notes:**
- 整合運務 APP 和後台產生的退貨單資料
- 狀態管理（未完成/已立單）

### Epic 7: 即時同步與通知基礎設施

系統可以即時同步狀態與發送通知，確保多裝置即時同步與通知功能正常運作。

**FRs covered:** FR59, FR60, FR61, FR62, FR63, FR64, FR65

**Implementation Notes:**
- WebSocket 即時同步機制
- 推播通知整合（運務 APP）
- 網路中斷處理與自動重連
- 此 Epic 可與其他 Epic 並行開發，但需在 Epic 4、5、6 完成前完成整合

### Epic 8: 後台管理功能擴充

後台管理員可以查看退貨單列表、查詢倉儲收貨資訊、同步查看前台資料、修改前台資料等管理功能。

**FRs covered:** FR68, FR69, FR70, FR71

**Implementation Notes:**
- 後台既有功能擴增：
  - 網站管理 > 區塊內容管理：新增「碼頭-忘記密碼」功能
  - 配送點管理 > 內部廠區：新增「入庫分貨配送點燈箱」
- 需整合現有後台管理架構

### Epic 9: 資料整合與審計

系統可以與現有後台系統整合資料，記錄所有狀態變更操作，確保資料一致性與可追溯性。

**FRs covered:** FR72, FR73, FR74, FR75, FR76

**Implementation Notes:**
- 與現有後台系統整合資料
- 操作記錄與審計日誌
- 資料完整性驗證
- 此 Epic 可與其他 Epic 並行開發，但需確保所有操作都有記錄

## Epic 1: 後台基礎資料管理（碼頭與人員）

後台管理員可以管理碼頭列表和碼頭人員列表，建立前台作業所需的基礎資料。此 Epic 必須優先完成，因為登入驗證與登入後的頁面顯示資料都依賴這些基礎資料。

**FRs covered:** FR66, FR67

### Story 1.1: 後台管理員可以查看碼頭列表

As a 後台管理員,
I want 查看所有碼頭列表,
So that 我可以了解系統中所有碼頭的設定狀況。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「碼頭管理 > 碼頭列表」頁面
**Then** 系統顯示所有碼頭記錄的列表
**And** 列表包含碼頭的基本資訊（碼頭名稱、狀態等）
**And** 支援基本搜尋或篩選功能（如依碼頭名稱搜尋）
**And** API 響應時間 < 300ms（NFR1）

### Story 1.2: 後台管理員可以新增碼頭

As a 後台管理員,
I want 新增碼頭記錄,
So that 我可以建立新的碼頭供前台作業使用。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭列表頁面
**When** 點擊「新增碼頭」按鈕並填寫必填欄位（碼頭名稱等）
**Then** 系統驗證必填欄位完整性
**And** 系統建立新的碼頭記錄並儲存至資料庫
**And** 系統顯示成功訊息並更新碼頭列表
**And** 新建立的碼頭可立即用於前台作業（Epic 4、Epic 5）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.3: 後台管理員可以編輯碼頭

As a 後台管理員,
I want 編輯現有碼頭資訊,
So that 我可以更新碼頭的設定資訊。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭列表頁面
**When** 點擊某個碼頭的「編輯」按鈕並修改碼頭資訊
**Then** 系統驗證資料完整性
**And** 系統更新碼頭記錄並儲存至資料庫
**And** 系統顯示成功訊息並更新碼頭列表
**And** 修改後的碼頭資訊即時反映在前台作業（Epic 4、Epic 5）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.4: 後台管理員可以刪除碼頭

As a 後台管理員,
I want 刪除碼頭記錄,
So that 我可以移除不再使用的碼頭。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭列表頁面
**When** 點擊某個碼頭的「刪除」按鈕
**Then** 系統檢查該碼頭是否被其他資料關聯使用（如出貨作業、收貨作業）
**And** 如果碼頭已被使用，系統顯示錯誤提示並阻止刪除
**And** 如果碼頭未被使用，系統刪除碼頭記錄
**And** 系統顯示成功訊息並更新碼頭列表
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.5: 後台管理員可以查看碼頭人員列表

As a 後台管理員,
I want 查看所有碼頭人員列表,
So that 我可以了解系統中所有碼頭人員的設定狀況。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「碼頭管理 > 碼頭人員列表」頁面
**Then** 系統顯示所有碼頭人員記錄的列表
**And** 列表包含碼頭人員的基本資訊（姓名、帳號、所屬碼頭、內部廠區等）
**And** 支援基本搜尋或篩選功能（如依姓名、帳號、碼頭搜尋）
**And** API 響應時間 < 300ms（NFR1）

### Story 1.6: 後台管理員可以新增碼頭人員

As a 後台管理員,
I want 新增碼頭人員記錄,
So that 我可以建立新的碼頭人員帳號供前台登入使用。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭人員列表頁面
**When** 點擊「新增碼頭人員」按鈕並填寫必填欄位（姓名、帳號、密碼、所屬碼頭、內部廠區等）
**Then** 系統驗證必填欄位完整性
**And** 系統驗證帳號唯一性（不允許重複帳號）
**And** 系統建立新的碼頭人員記錄並儲存至資料庫
**And** 系統顯示成功訊息並更新碼頭人員列表
**And** 新建立的碼頭人員可立即用於前台登入驗證（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.7: 後台管理員可以編輯碼頭人員

As a 後台管理員,
I want 編輯現有碼頭人員資訊,
So that 我可以更新碼頭人員的設定（如修改密碼、變更所屬碼頭、調整內部廠區等）。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭人員列表頁面
**When** 點擊某個碼頭人員的「編輯」按鈕並修改人員資訊
**Then** 系統驗證資料完整性
**And** 如果修改帳號，系統驗證帳號唯一性
**And** 系統更新碼頭人員記錄並儲存至資料庫
**And** 系統顯示成功訊息並更新碼頭人員列表
**And** 修改後的碼頭人員資訊即時反映在前台登入驗證和資料隔離（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 1.8: 後台管理員可以刪除碼頭人員

As a 後台管理員,
I want 刪除碼頭人員記錄,
So that 我可以移除不再使用的碼頭人員帳號。

**Acceptance Criteria:**

**Given** 後台管理員在碼頭人員列表頁面
**When** 點擊某個碼頭人員的「刪除」按鈕
**Then** 系統檢查該碼頭人員是否被其他資料關聯使用（如操作記錄等）
**And** 如果人員已被使用，系統顯示錯誤提示並阻止刪除，或提供停用選項
**And** 如果人員未被使用，系統刪除碼頭人員記錄
**And** 系統顯示成功訊息並更新碼頭人員列表
**And** 刪除後該人員無法再登入前台系統（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

## Epic 2: 身份驗證與基礎設定

倉儲人員可以安全登入系統，查看基本資訊，系統根據登入人員的內部廠區設定顯示符合該廠區的資料。

**FRs covered:** FR1, FR2, FR3, FR4, FR5, FR6

### Story 2.1: 倉儲人員可以使用帳號密碼登入系統

As a 倉儲人員,
I want 使用後台設定的帳號密碼登入系統,
So that 我可以存取碼頭作業系統進行日常工作。

**Acceptance Criteria:**

**Given** 倉儲人員在登入頁面
**When** 輸入有效的帳號和密碼（帳號存在於後台碼頭人員列表中）
**Then** 系統整合後台碼頭人員列表進行身份驗證（FR6）
**And** 系統驗證登入憑證成功
**And** 系統建立會話並導向系統主頁面
**And** 系統根據登入人員的內部廠區設定，只顯示符合該廠區的資料（FR5）
**And** 頁面載入時間 < 2 秒（NFR2）
**And** 登入操作響應時間 < 500ms（NFR3）

### Story 2.2: 系統可以驗證登入憑證並顯示錯誤提示

As a 倉儲人員,
I want 系統在登入失敗時顯示明確的錯誤提示,
So that 我可以知道登入失敗的原因並修正。

**Acceptance Criteria:**

**Given** 倉儲人員在登入頁面
**When** 輸入無效的帳號或密碼（帳號不存在、密碼錯誤、帳號已停用等）
**Then** 系統驗證登入憑證失敗（FR2）
**And** 系統顯示明確的錯誤提示訊息（不洩露帳號是否存在等敏感資訊）
**And** 系統不建立會話，停留在登入頁面
**And** 錯誤提示響應時間 < 500ms（NFR3）
**And** 系統整合後台碼頭人員列表進行驗證（FR6）

### Story 2.3: 倉儲人員可以查看忘記密碼的相關資訊

As a 倉儲人員,
I want 查看忘記密碼的相關資訊,
So that 我可以知道如何處理忘記密碼的情況。

**Acceptance Criteria:**

**Given** 倉儲人員在登入頁面
**When** 點擊「忘記密碼」連結
**Then** 系統顯示忘記密碼頁面
**And** 系統從後台「網站管理 > 區塊內容管理 > 碼頭-忘記密碼」取得提示文字並顯示（FR3）
**And** 提示文字包含如何聯繫管理員或重置密碼的資訊
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 2.4: 倉儲人員可以安全登出系統

As a 倉儲人員,
I want 安全登出系統,
So that 我可以確保會話結束，保護帳號安全。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統
**When** 點擊「登出」按鈕（位於固定頂部功能列）
**Then** 系統終止當前會話（FR4）
**And** 系統清除會話資料
**And** 系統導向登入頁面
**And** 登出後無法再存取需要登入的頁面
**And** 會話逾時時系統自動登出（NFR15）

### Story 2.5: 系統可以根據登入人員的內部廠區設定顯示符合該廠區的資料

As a 倉儲人員,
I want 系統只顯示符合我內部廠區設定的資料,
So that 我不會看到其他廠區的資料，確保資料隔離。

**Acceptance Criteria:**

**Given** 倉儲人員已成功登入系統
**When** 系統載入任何資料（出貨作業、收貨作業、退貨作業等）
**Then** 系統根據登入人員的內部廠區設定，只顯示符合該廠區的資料（FR5）
**And** 所有資料查詢都自動套用廠區資料隔離篩選條件
**And** 系統不顯示其他廠區的資料
**And** 資料隔離在後端 API 層級實作，確保安全性（NFR18）
**And** 資料存取控制依照人員權限限制操作範圍（NFR19）

### Story 2.6: 系統可以整合後台碼頭人員列表進行身份驗證

As a 系統,
I want 整合後台碼頭人員列表進行身份驗證,
So that 登入驗證使用統一的資料來源，確保一致性。

**Acceptance Criteria:**

**Given** 系統需要驗證倉儲人員的登入憑證
**When** 倉儲人員嘗試登入
**Then** 系統查詢後台碼頭人員列表（Epic 1 建立的資料）
**And** 系統驗證帳號是否存在於碼頭人員列表中（FR6）
**And** 系統驗證密碼是否正確
**And** 系統驗證帳號狀態（是否啟用）
**And** 驗證過程整合現有後台系統架構
**And** 驗證響應時間 < 500ms（NFR3）

## Epic 3: 即時公告管理

倉儲人員可以查看與管理公告，包括篩選、標記已讀、刪除等操作。

**FRs covered:** FR7, FR8, FR9, FR10, FR11, FR12, FR13, FR14

### Story 3.1: 倉儲人員可以查看公告列表

As a 倉儲人員,
I want 查看公告列表,
So that 我可以了解最新的公告資訊。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統
**When** 點擊固定頂部功能列的「即時公告」按鈕
**Then** 系統顯示公告列表頁面（FR7）
**And** 列表顯示所有公告的基本資訊（標題、日期、時間、已讀/未讀狀態等）
**And** 系統顯示公告的已讀/未讀狀態（FR14）
**And** 頁面載入時間 < 2 秒（NFR2）
**And** 系統沿用現有公告系統架構

### Story 3.2: 倉儲人員可以篩選公告列表

As a 倉儲人員,
I want 篩選公告列表,
So that 我可以快速找到特定條件的公告。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面
**When** 使用篩選功能（如依日期範圍、已讀/未讀狀態等篩選）
**Then** 系統根據篩選條件動態更新公告列表（FR8）
**And** 篩選響應時間 < 500ms（NFR4）
**And** 篩選條件可組合使用

### Story 3.3: 倉儲人員可以查看公告詳細內容

As a 倉儲人員,
I want 查看公告詳細內容,
So that 我可以了解公告的完整資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面
**When** 點擊某個公告項目
**Then** 系統顯示公告詳細內容頁面（FR13）
**And** 詳細內容包含日期、時間、標題、內容等完整資訊
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 3.4: 倉儲人員可以標記單一公告為已讀

As a 倉儲人員,
I want 標記單一公告為已讀,
So that 我可以追蹤已閱讀的公告。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面或公告詳細頁面
**When** 點擊「標記為已讀」按鈕（針對單一公告）
**Then** 系統將該公告標記為已讀（FR9）
**And** 系統更新公告的已讀/未讀狀態顯示（FR14）
**And** 操作響應時間 < 500ms（NFR3）
**And** 已讀狀態即時反映在列表和詳細頁面

### Story 3.5: 倉儲人員可以批量標記公告為已讀

As a 倉儲人員,
I want 批量標記公告為已讀（依照篩選條件）,
So that 我可以一次標記多個符合條件的公告為已讀，提高效率。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面
**When** 設定篩選條件並點擊「批量標記為已讀」按鈕
**Then** 系統將所有符合篩選條件的公告標記為已讀（FR11）
**And** 系統更新所有相關公告的已讀/未讀狀態顯示（FR14）
**And** 系統顯示成功訊息（如「已標記 X 筆公告為已讀」）
**And** 操作響應時間 < 500ms（NFR3）
**And** 批量操作支援依照篩選條件執行

### Story 3.6: 倉儲人員可以刪除單一公告

As a 倉儲人員,
I want 刪除單一公告,
So that 我可以移除不需要的公告。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面或公告詳細頁面
**When** 點擊「刪除」按鈕（針對單一公告）
**Then** 系統顯示確認對話框
**And** 確認後系統刪除該公告（FR10）
**And** 系統更新公告列表，移除已刪除的公告
**And** 操作響應時間 < 500ms（NFR3）

### Story 3.7: 倉儲人員可以批量刪除公告

As a 倉儲人員,
I want 批量刪除公告（依照篩選條件）,
So that 我可以一次刪除多個符合條件的公告，提高效率。

**Acceptance Criteria:**

**Given** 倉儲人員在公告列表頁面
**When** 設定篩選條件並點擊「批量刪除」按鈕
**Then** 系統顯示確認對話框，顯示將刪除的公告數量
**And** 確認後系統刪除所有符合篩選條件的公告（FR12）
**And** 系統更新公告列表，移除已刪除的公告
**And** 系統顯示成功訊息（如「已刪除 X 筆公告」）
**And** 操作響應時間 < 500ms（NFR3）
**And** 批量操作支援依照篩選條件執行

## Epic 4: 出貨作業管理

倉儲人員可以管理碼頭出貨作業，包括查看碼頭儀錶板、選擇車次、發送通知、修改車輛狀態等完整出貨流程。

**FRs covered:** FR15, FR16, FR17, FR18, FR19, FR20, FR21, FR22, FR23, FR24, FR25

### Story 4.1: 倉儲人員可以查看碼頭儀錶板即時狀態

As a 倉儲人員,
I want 查看碼頭儀錶板顯示所有碼頭的即時狀態,
So that 我可以一眼了解所有碼頭的當前狀況。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並進入出貨作業頁面
**When** 系統載入出貨作業頁面
**Then** 系統顯示碼頭儀錶板，一橫排顯示所有碼頭（FR15）
**And** 碼頭儀錶板顯示所有碼頭的即時狀態（依賴 Epic 1 的碼頭列表）
**And** 系統根據車輛狀態以不同顏色顯示碼頭（FR16）：
  - 綠色實色背景（#8eba34）：正常狀態
  - 藍色實色背景（#3a9cd8）：缺貨待料
  - 紅色實色背景（#f68480）：通知未到
**And** 碼頭儀錶板狀態更新延遲 < 3 秒（NFR9）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 4.2: 倉儲人員可以從未排車次的碼頭下拉選單選擇符合條件的車輛

As a 倉儲人員,
I want 從未排車次的碼頭下拉選單中選擇符合條件的車輛,
So that 我可以為碼頭分配適當的車次進行出貨作業。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面，某個碼頭未排車次
**When** 點擊該碼頭的下拉選單
**Then** 系統顯示符合條件的車輛列表（FR17）
**And** 系統根據條件篩選可選車輛（FR18）：
  - 配送日期為當天
  - 任務起點為同廠區（依賴 Epic 2 的廠區資料隔離）
  - 有送貨配送單
  - 尚未完成出車或取消
**And** 下拉選單響應時間 < 500ms（NFR4）
**And** 選擇車次後，碼頭顯示車牌（車次）與喇叭 icon，底色變為綠色

### Story 4.3: 倉儲人員可以發送通知給選定任務的運務

As a 倉儲人員,
I want 發送通知給選定任務的運務,
So that 我可以通知運務前往碼頭進行出貨作業。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面，某個碼頭已選定車次
**When** 點擊該碼頭的喇叭 icon
**Then** 系統發送通知給選定任務的運務（FR19）
**And** 系統顯示提示文字「已通知司機前往碼頭」
**And** 系統整合現有通知系統（NoticeService、PushServiceProvider）
**And** 通知發送響應時間 < 500ms（NFR3）
**And** 通知可透過推播通知整合發送到運務 APP（為 Epic 7 做準備）

### Story 4.4: 倉儲人員可以查看任務內含的所有配送單資訊

As a 倉儲人員,
I want 查看任務內含的所有配送單資訊,
So that 我可以了解該車次的完整配送內容。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面，某個碼頭已選定車次
**When** 點擊該碼頭（非喇叭 icon）
**Then** 系統跳出車次詳細配送單燈箱（FR20）
**And** 燈箱遮罩不覆蓋整個頁面，僅在燈箱區域顯示遮罩
**And** 燈箱顯示基本資訊區塊：上班時間、司機姓名、車號車次、路線別
**And** 燈箱顯示配送資訊，各配送點可點擊收合展開
**And** 單一配送點可能有多位客戶的配送單，分開各自也可收合展開
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 4.5: 倉儲人員可以修改車輛狀態為完成出車或取消

As a 倉儲人員,
I want 在車次詳細配送單燈箱中修改車輛狀態為完成出車或取消,
So that 我可以記錄車輛已完成出車或取消出貨。

**Acceptance Criteria:**

**Given** 倉儲人員在車次詳細配送單燈箱中
**When** 點擊燈箱內最下方的「完成出車」或「取消」按鈕
**Then** 系統更新車輛狀態（FR21）
**And** 如果選擇「完成出車」，系統顯示提示文字「已完成出車」
**And** 系統根據車輛狀態變更自動更新顯示（FR22）：
  - 完成出車/取消的車輛不再顯示於碼頭儀錶板
  - 車輛從儀錶板移除
**And** 狀態變更顏色更新即時反映（< 1 秒）（NFR10）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 4.6: 倉儲人員可以修改車輛狀態為缺貨待料

As a 倉儲人員,
I want 在車次詳細配送單燈箱中修改車輛狀態為缺貨待料,
So that 我可以記錄車輛因缺貨待料而無法出貨。

**Acceptance Criteria:**

**Given** 倉儲人員在車次詳細配送單燈箱中
**When** 點擊燈箱內最下方的「缺貨待料」按鈕
**Then** 系統更新車輛狀態為缺貨待料（FR21）
**And** 系統根據車輛狀態變更自動更新顯示（FR22）：
  - 車輛狀態改為缺貨待料
  - 碼頭底色改為藍色實色（#3a9cd8）
  - 車輛從儀錶板移除
  - 車輛顯示於未排車次列表
**And** 系統關閉詳細資訊燈箱，回到出貨作業頁面
**And** 狀態變更顏色更新即時反映（< 1 秒）（NFR10）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 4.7: 倉儲人員可以修改車輛狀態為通知未到

As a 倉儲人員,
I want 在車次詳細配送單燈箱中修改車輛狀態為通知未到,
So that 我可以記錄車輛因通知未到而無法出貨。

**Acceptance Criteria:**

**Given** 倉儲人員在車次詳細配送單燈箱中
**When** 點擊燈箱內最下方的「通知未到」按鈕
**Then** 系統更新車輛狀態為通知未到（FR21）
**And** 系統根據車輛狀態變更自動更新顯示（FR22）：
  - 車輛狀態改為通知未到
  - 碼頭底色改為紅色實色（#f68480）
  - 車輛從儀錶板移除
  - 車輛顯示於未排車次列表
**And** 系統發送通知給運務和運務部後台主管
**And** 系統關閉詳細資訊燈箱，回到出貨作業頁面
**And** 狀態變更顏色更新即時反映（< 1 秒）（NFR10）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 4.8: 倉儲人員可以查看未排車次列表

As a 倉儲人員,
I want 查看未排車次列表,
So that 我可以了解尚未分配到碼頭的車輛狀況。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面
**When** 系統載入未排車次列表
**Then** 系統顯示所有未排車次的車輛列表（FR23）
**And** 系統根據車輛狀態以不同顏色顯示未排車次（FR25）：
  - 綠色（#8eba34）：正常
  - 紅色（#f68480）：通知未到
  - 藍色（#3a9cd8）：缺貨待料
**And** 列表只顯示符合登入人員內部廠區的車輛（依賴 Epic 2）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 4.9: 倉儲人員可以篩選未排車次列表

As a 倉儲人員,
I want 篩選未排車次列表,
So that 我可以快速找到特定條件的未排車次。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面
**When** 使用篩選列設定篩選條件（針對未排車次列表）
**Then** 系統根據篩選條件動態更新未排車次列表（FR24）
**And** 篩選響應時間 < 500ms（NFR11）
**And** 篩選條件可組合使用
**And** 篩選後的列表仍保持顏色狀態顯示（FR25）

### Story 4.10: 系統可以即時更新碼頭儀錶板和未排車次列表的狀態

As a 倉儲人員,
I want 系統即時更新碼頭儀錶板和未排車次列表的狀態,
So that 我可以看到最新的車輛狀態變化。

**Acceptance Criteria:**

**Given** 倉儲人員在出貨作業頁面
**When** 車輛狀態發生變更（完成出車、取消、缺貨待料、通知未到）
**Then** 系統根據車輛狀態變更自動更新顯示（FR22）：
  - 完成出車/取消的車輛不再顯示於碼頭儀錶板
  - 缺貨待料/通知未到的車輛回到未排車次列表
**And** 碼頭儀錶板狀態更新延遲 < 3 秒（NFR9）
**And** 車輛狀態變更反映顏色更新即時反映（< 1 秒）（NFR10）
**And** 狀態變更透過即時同步機制更新（為 Epic 7 做準備）
**And** 多裝置同步延遲 < 3 秒（NFR8）

## Epic 5: 收貨作業管理

倉儲人員可以管理收貨作業，包括查看收貨列表、進入配送點總表、查看收貨明細、請運務簽名等完整收貨流程。

**FRs covered:** FR26, FR27, FR28, FR29, FR30, FR31, FR32, FR33, FR34, FR35, FR36, FR37, FR38, FR39, FR40, FR41, FR42, FR43, FR44, FR45, FR46, FR47, FR48, FR49, FR50, FR51

### Story 5.1: 倉儲人員可以查看收貨列表

As a 倉儲人員,
I want 查看收貨列表顯示所有包含收貨的任務,
So that 我可以了解所有需要處理的收貨任務。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並點擊固定頂部功能列的「收貨作業」
**When** 系統載入收貨列表頁面
**Then** 系統顯示所有包含收貨的任務列表（FR26）
**And** 列表顯示任務的關鍵資訊（車號、狀態、回報時間等）
**And** 列表只顯示符合登入人員內部廠區的任務（依賴 Epic 2）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.2: 系統可以追蹤任務的下貨狀態

As a 倉儲人員,
I want 系統追蹤任務的下貨狀態,
So that 我可以了解任務的當前進度。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面
**When** 系統載入任務列表
**Then** 系統追蹤任務的下貨狀態（FR28）：
  - 接貨中：運務正在接貨
  - 回廠下貨：運務已回報回廠下貨
**And** 系統顯示任務的當前狀態
**And** 狀態即時更新（為 Epic 7 做準備）

### Story 5.3: 系統可以接收運務回報的「回廠下貨」狀態並更新任務狀態

As a 系統,
I want 接收運務 APP 回報的「回廠下貨」狀態,
So that 我可以即時更新任務狀態，讓倉儲人員知道運務已回廠。

**Acceptance Criteria:**

**Given** 運務透過運務 APP 回報「回廠下貨」狀態
**When** 系統接收運務 APP 回報的狀態
**Then** 系統更新任務狀態為「回廠下貨」（FR29）
**And** 系統顯示回廠下貨任務的車輛回報位置和時間（FR30）
**And** 狀態更新即時反映在收貨列表中（< 3 秒）（NFR5）
**And** 系統整合運務 APP 整合（為 Epic 7 做準備）

### Story 5.4: 倉儲人員可以為回廠下貨的任務選擇下貨碼頭

As a 倉儲人員,
I want 為回廠下貨的任務選擇下貨碼頭,
So that 我可以指定運務應該在哪個碼頭下貨。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面，某個任務狀態為「回廠下貨」
**When** 點擊該任務的下貨碼頭選擇功能
**Then** 系統顯示可選的下貨碼頭列表（FR31，依賴 Epic 1 的碼頭列表）
**And** 系統自動排除已選定出貨和下貨的碼頭選項（FR32）
**And** 選擇下貨碼頭後，系統更新任務的下貨碼頭資訊
**And** 系統推播通知到運務 APP 給該司機，通知已選定下貨碼頭
**And** 原運務 APP 回廠下貨按鈕顯示下貨碼頭名稱
**And** 操作響應時間 < 500ms（NFR3）
**And** 通知整合推播通知系統（為 Epic 7 做準備）

### Story 5.5: 系統可以依照狀態和回報時間排序收貨列表

As a 倉儲人員,
I want 收貨列表依照狀態和回報時間排序,
So that 我可以優先處理需要立即處理的任務。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面
**When** 系統載入或更新收貨列表
**Then** 系統依照狀態和回報時間排序收貨列表（FR34）：
  - 先顯示「回廠下貨」狀態的任務
  - 再顯示「接貨中」狀態的任務
  - 同樣狀態依回報時間新到舊排序
**And** 排序響應時間 < 1 秒（NFR12）

### Story 5.6: 倉儲人員可以篩選收貨列表

As a 倉儲人員,
I want 篩選收貨列表,
So that 我可以快速找到特定條件的收貨任務。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面
**When** 使用篩選功能設定篩選條件
**Then** 系統根據篩選條件動態更新收貨列表（FR27）
**And** 篩選響應時間 < 1 秒（NFR12）
**And** 篩選條件可組合使用

### Story 5.7: 倉儲人員可以從收貨列表進入任務的配送點總表

As a 倉儲人員,
I want 從收貨列表進入任務的配送點總表,
So that 我可以查看該任務的所有配送點資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨列表頁面，某個任務狀態為「未完成」
**When** 點擊列表欄位的「車號」（顯示為可點擊按鈕）
**Then** 系統進入該任務的配送點總表（FR33）
**And** 如果任務狀態為「已完成」，車號顯示為純文字（非按鈕），無法點擊
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.8: 倉儲人員可以查看配送點總表

As a 倉儲人員,
I want 查看配送點總表顯示任務所有有收貨的配送單資訊,
So that 我可以了解該任務的所有配送點狀況。

**Acceptance Criteria:**

**Given** 倉儲人員在配送點總表頁面
**When** 系統載入配送點總表
**Then** 系統顯示任務所有有收貨的配送單資訊（FR35）
**And** 配送點總表依配送單客戶和配送點做分類，一個客戶+配送點顯示為一列
**And** 相同配送點排序在一起
**And** 列表顯示配送點的關鍵資訊（配送點、客戶、收貨類型、狀態等）
**And** 不同狀態以小方框不同顏色顯示（使用狀態顏色系統）
**And** 收貨類型顯示為「入庫分貨」或「越庫作業」（自動判斷，依賴後台內部廠區設定的入庫分貨配送點）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.9: 倉儲人員可以從配送點總表進入收貨明細

As a 倉儲人員,
I want 從配送點總表進入收貨明細,
So that 我可以查看並修改該配送點的詳細收貨資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在配送點總表頁面
**When** 點擊列表欄位的「配送點」
**Then** 系統進入收貨明細頁面（FR36）
**And** 系統自動判斷收貨明細類型（入庫分貨/越庫作業）：
  - 如果配送單迄點與登入人員的內部廠區關聯為入庫分貨 → 收貨明細類型為入庫分貨
  - 否則 → 收貨明細類型為越庫作業
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.10: 倉儲人員可以查看入庫分貨的收貨明細

As a 倉儲人員,
I want 查看入庫分貨的收貨明細,
So that 我可以核對並修改入庫分貨的商品資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨明細頁面，收貨明細類型為「入庫分貨」
**When** 系統載入收貨明細
**Then** 系統顯示入庫分貨的收貨明細（FR40）
**And** 系統顯示收貨明細的進入時間並持續動態更新（FR42）
**And** 系統顯示配送單的商品資訊（FR43）：客戶簡稱、商品名稱、單據資訊等
**And** 系統顯示每項商品的實收數量與有效日期（可多組）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.11: 倉儲人員可以查看越庫作業的收貨明細

As a 倉儲人員,
I want 查看越庫作業的收貨明細,
So that 我可以核對並修改越庫作業的商品資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在收貨明細頁面，收貨明細類型為「越庫作業」
**When** 系統載入收貨明細
**Then** 系統顯示越庫作業的收貨明細（FR41）
**And** 系統顯示收貨明細的進入時間並持續動態更新（FR42）
**And** 系統顯示配送單的商品資訊（FR43）：客戶簡稱、商品名稱、單據資訊等
**And** 系統顯示每項商品的配送點、實收板位、配送日期與備註（可多組）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 5.12: 倉儲人員可以修改入庫分貨的實收數量

As a 倉儲人員,
I want 修改入庫分貨的實收數量,
So that 我可以記錄實際收到的商品數量。

**Acceptance Criteria:**

**Given** 倉儲人員在入庫分貨的收貨明細頁面
**When** 修改某項商品的實收數量
**Then** 系統更新該商品的實收數量（FR44）
**And** 系統驗證實收數量的合理性
**And** 修改即時儲存或提供儲存按鈕
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.13: 倉儲人員可以為入庫分貨的商品新增多組實收數量與有效日期

As a 倉儲人員,
I want 為入庫分貨的商品新增多組實收數量與有效日期,
So that 我可以記錄不同批次的商品資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在入庫分貨的收貨明細頁面
**When** 點擊「新增」按鈕為某項商品新增實收數量與有效日期
**Then** 系統新增一組實收數量與有效日期欄位（FR45）
**And** 系統驗證必填欄位（實收數量、有效日期）
**And** 系統允許為同一商品新增多組資料
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.14: 倉儲人員可以刪除入庫分貨商品的多組實收數量與有效日期資料

As a 倉儲人員,
I want 刪除入庫分貨商品的多組實收數量與有效日期資料,
So that 我可以移除錯誤或不需要的資料。

**Acceptance Criteria:**

**Given** 倉儲人員在入庫分貨的收貨明細頁面，某項商品有多組實收數量與有效日期
**When** 點擊某組資料的「刪除」按鈕
**Then** 系統檢查該商品是否只剩一組資料
**And** 如果只剩一組，系統顯示錯誤提示並阻止刪除（最少必須保留一組）
**And** 如果有多組，系統刪除該組資料（FR46）
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.15: 倉儲人員可以為入庫分貨的商品填寫備註

As a 倉儲人員,
I want 為入庫分貨的商品填寫備註,
So that 我可以記錄特殊情況或注意事項。

**Acceptance Criteria:**

**Given** 倉儲人員在入庫分貨的收貨明細頁面
**When** 為某項商品填寫備註
**Then** 系統儲存備註資訊（FR47）
**And** 備註可即時儲存或提供儲存按鈕
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.16: 倉儲人員可以修改越庫作業的實收板位

As a 倉儲人員,
I want 修改越庫作業的實收板位,
So that 我可以記錄實際收到的板位資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在越庫作業的收貨明細頁面
**When** 修改某項商品的實收板位
**Then** 系統更新該商品的實收板位（FR48）
**And** 系統驗證實收板位的格式或合理性
**And** 修改即時儲存或提供儲存按鈕
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.17: 倉儲人員可以為越庫作業的商品新增多組配送點、實收板位、配送日期與備註

As a 倉儲人員,
I want 為越庫作業的商品新增多組配送點、實收板位、配送日期與備註,
So that 我可以記錄不同配送點的資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在越庫作業的收貨明細頁面
**When** 點擊「新增」按鈕為某項商品新增配送點、實收板位、配送日期與備註
**Then** 系統新增一組配送點、實收板位、配送日期與備註欄位（FR49）
**And** 系統驗證必填欄位（配送點、實收板位、配送日期）
**And** 系統允許為同一商品新增多組資料
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.18: 倉儲人員可以刪除越庫作業商品的多組資料

As a 倉儲人員,
I want 刪除越庫作業商品的多組資料（配送點、實收板位、配送日期與備註）,
So that 我可以移除錯誤或不需要的資料。

**Acceptance Criteria:**

**Given** 倉儲人員在越庫作業的收貨明細頁面，某項商品有多組資料
**When** 點擊某組資料的「刪除」按鈕
**Then** 系統檢查該商品是否只剩一組資料
**And** 如果只剩一組，系統顯示錯誤提示並阻止刪除（最少必須保留一組）
**And** 如果有多組，系統刪除該組資料（FR50）
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.19: 倉儲人員可以為越庫作業的商品填寫備註

As a 倉儲人員,
I want 為越庫作業的商品填寫備註,
So that 我可以記錄特殊情況或注意事項。

**Acceptance Criteria:**

**Given** 倉儲人員在越庫作業的收貨明細頁面
**When** 為某項商品填寫備註
**Then** 系統儲存備註資訊（FR51）
**And** 備註可即時儲存或提供儲存按鈕
**And** 操作響應時間 < 500ms（NFR3）

### Story 5.20: 倉儲人員可以請運務在配送點總表簽名

As a 倉儲人員,
I want 請運務在配送點總表簽名,
So that 我可以確認運務已完成收貨作業。

**Acceptance Criteria:**

**Given** 倉儲人員在配送點總表頁面，已完成所有收貨明細的核對
**When** 點擊「收貨完成」按鈕
**Then** 系統跳出簽名板燈箱（FR37）
**And** 簽名板至少 300x150px，支援觸控繪製
**And** 簽名板顯示「送出」按鈕
**And** 簽名板操作完成時間 < 10 秒（NFR13）

### Story 5.21: 系統可以在運務簽名送出後將任務收貨狀態更新為已完成

As a 系統,
I want 在運務簽名送出後將任務收貨狀態更新為已完成,
So that 我可以記錄收貨作業已完成。

**Acceptance Criteria:**

**Given** 倉儲人員在簽名板燈箱中，運務已完成簽名
**When** 點擊「送出」按鈕
**Then** 系統驗證簽名資料完整性
**And** 系統將簽名資料回傳後台紀錄（FR38）
**And** 系統將任務收貨狀態更新為「已完成」
**And** 系統跳轉回收貨列表
**And** 該任務的車號改為純顯示（非按鈕），不可再次進入配送點總表（FR39）
**And** 收貨明細資料儲存成功率 > 99.9%（NFR31）
**And** 操作記錄被記錄（為 Epic 9 做準備）

## Epic 6: 退貨作業管理

倉儲人員可以查看與管理退貨單，包括篩選、編輯、查看等操作。

**FRs covered:** FR52, FR53, FR54, FR55, FR56, FR57, FR58

### Story 6.1: 倉儲人員可以查看退貨單列表

As a 倉儲人員,
I want 查看退貨單列表,
So that 我可以了解所有需要處理的退貨單。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並點擊固定頂部功能列的「退貨作業」
**When** 系統載入退貨單列表頁面
**Then** 系統顯示所有退貨單列表（FR52）
**And** 系統顯示退貨單的關鍵資訊（FR54）：退貨單號、建立日期、原配送單號、客戶簡稱、退貨類型、狀態
**And** 列表只顯示符合登入人員內部廠區的退貨單（依賴 Epic 2）
**And** 系統整合運務 APP 和後台產生的退貨單資料（FR58）
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 6.2: 倉儲人員可以篩選退貨單列表

As a 倉儲人員,
I want 篩選退貨單列表,
So that 我可以快速找到特定條件的退貨單。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面
**When** 使用篩選功能設定篩選條件
**Then** 系統根據篩選條件動態更新退貨單列表（FR53）
**And** 篩選響應時間 < 500ms（NFR4）
**And** 篩選條件可組合使用

### Story 6.3: 倉儲人員可以編輯狀態為「未完成」的退貨單

As a 倉儲人員,
I want 編輯狀態為「未完成」的退貨單,
So that 我可以修改退貨單的內容。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面，某個退貨單狀態為「未完成」
**When** 點擊該退貨單的「編輯」按鈕
**Then** 系統進入退貨單詳細頁面，顯示編輯模式（FR55）
**And** 倉儲人員可以修改退貨單的商品內容（FR57）
**And** 系統驗證資料完整性
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 6.4: 倉儲人員可以查看狀態為「已立單」的退貨單（唯讀）

As a 倉儲人員,
I want 查看狀態為「已立單」的退貨單,
So that 我可以了解已完成立單的退貨單資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單列表頁面，某個退貨單狀態為「已立單」
**When** 點擊該退貨單的「查看」按鈕
**Then** 系統進入退貨單詳細頁面，顯示唯讀模式（FR56）
**And** 系統顯示完整的退貨單資訊和商品內容
**And** 系統不允許編輯退貨單內容
**And** 頁面載入時間 < 2 秒（NFR2）

### Story 6.5: 倉儲人員可以修改退貨單的商品內容

As a 倉儲人員,
I want 修改退貨單的商品內容,
So that 我可以更新退貨單的商品資訊。

**Acceptance Criteria:**

**Given** 倉儲人員在退貨單詳細頁面（編輯模式），退貨單狀態為「未完成」
**When** 修改退貨單的商品內容（新增、刪除、修改商品）
**Then** 系統驗證商品內容的完整性（FR57）
**And** 系統儲存修改後的退貨單商品內容
**And** 系統顯示成功訊息
**And** 操作響應時間 < 500ms（NFR3）

### Story 6.6: 系統可以整合運務 APP 和後台產生的退貨單資料

As a 系統,
I want 整合運務 APP 和後台產生的退貨單資料,
So that 退貨單資料來源統一，確保資料一致性。

**Acceptance Criteria:**

**Given** 系統需要顯示退貨單列表
**When** 系統載入退貨單資料
**Then** 系統整合運務 APP 產生的退貨單資料（FR58）
**And** 系統整合後台產生的退貨單資料（FR58）
**And** 系統統一顯示所有退貨單，不論資料來源
**And** 資料格式相容，確保與現有系統的資料格式相容（NFR42）
**And** 資料同步準確率 100%（NFR28）

## Epic 7: 即時同步與通知基礎設施

系統可以即時同步狀態與發送通知，確保多裝置即時同步與通知功能正常運作。

**FRs covered:** FR59, FR60, FR61, FR62, FR63, FR64, FR65

### Story 7.1: 系統可以透過 WebSocket 維持即時連線

As a 系統,
I want 透過 WebSocket 維持即時連線,
So that 系統可以即時同步資料和發送通知。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統
**When** 系統初始化
**Then** 系統透過 WebSocket 建立即時連線（FR61）
**And** WebSocket 連線穩定性：連線中斷率 < 0.1%（NFR7）
**And** 系統使用加密連線（WSS）（NFR20）
**And** 連線建立後系統維持連線狀態

### Story 7.2: 系統可以即時同步後台操作到前端顯示

As a 倉儲人員,
I want 系統即時同步後台操作到前端顯示,
So that 我可以看到最新的資料變化。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並建立 WebSocket 連線
**When** 後台發生資料變更操作（如狀態變更、資料更新等）
**Then** 系統透過 WebSocket 即時同步後台操作到前端顯示（FR59）
**And** 後台操作反映時間 < 3 秒（NFR5）
**And** 狀態變更同步準確率 100%（NFR6）
**And** 多裝置同步延遲 < 3 秒（NFR8）

### Story 7.3: 系統可以即時同步前端操作到後台和其他裝置

As a 倉儲人員,
I want 系統即時同步前端操作到後台和其他裝置,
So that 其他裝置可以看到我的操作結果。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並建立 WebSocket 連線
**When** 倉儲人員在前端進行操作（如修改狀態、更新資料等）
**Then** 系統透過 WebSocket 即時同步前端操作到後台（FR60）
**And** 系統同步前端操作到其他裝置（FR60）
**And** 狀態變更同步準確率 100%（NFR6）
**And** 多裝置同步延遲 < 3 秒（NFR8）

### Story 7.4: 系統可以在網路中斷時提示使用者

As a 倉儲人員,
I want 系統在網路中斷時提示我,
So that 我可以知道網路連線狀態並採取適當行動。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統並建立 WebSocket 連線
**When** 網路連線中斷
**Then** 系統偵測到網路中斷並提示使用者（FR62）
**And** 系統顯示網路中斷提示訊息
**And** 系統在網路恢復後自動重新連線（NFR32）
**And** 網路中斷處理：提示使用者，並在恢復後自動重新連線（NFR32）

### Story 7.5: 系統可以支援多裝置同時監控並保持資料同步

As a 倉儲人員,
I want 系統支援多裝置同時監控並保持資料同步,
So that 我可以在不同裝置上看到相同的資料。

**Acceptance Criteria:**

**Given** 倉儲人員在多個裝置上登入系統
**When** 任一裝置發生資料變更
**Then** 系統支援多裝置同時監控並保持資料同步（FR63）
**And** 所有裝置的資料保持同步
**And** 多裝置同步延遲 < 3 秒（NFR8）
**And** 系統穩定性：支援多裝置同時監控，具備斷線提示與容錯（NFR27）

### Story 7.6: 系統可以發送推播通知到運務 APP

As a 系統,
I want 發送推播通知到運務 APP,
So that 我可以通知運務相關的狀態變更或重要訊息。

**Acceptance Criteria:**

**Given** 系統需要發送通知給運務（如出貨通知、下貨碼頭通知等）
**When** 系統觸發推播通知
**Then** 系統發送推播通知到運務 APP（FR64）
**And** 系統整合現有通知系統（PushServiceProvider）
**And** 推播通知整合：發送推播通知到運務 APP（NFR41）
**And** 通知發送成功率 > 99.5%

### Story 7.7: 系統可以接收運務 APP 回報的狀態

As a 系統,
I want 接收運務 APP 回報的狀態,
So that 我可以即時更新任務狀態。

**Acceptance Criteria:**

**Given** 運務透過運務 APP 回報狀態（如回廠下貨）
**When** 系統接收運務 APP 回報的狀態
**Then** 系統接收運務 APP 回報的狀態並更新任務狀態（FR65）
**And** 系統整合運務 APP 整合：接收運務 APP 回報的狀態（NFR40）
**And** 狀態更新即時反映在相關頁面（< 3 秒）（NFR5）
**And** 狀態變更同步準確率 100%（NFR6）

### Story 7.8: WebSocket 連線恢復機制

As a 系統,
I want WebSocket 連線中斷時自動重連,
So that 我可以確保資料不遺失並維持即時同步。

**Acceptance Criteria:**

**Given** 倉儲人員已登入系統，WebSocket 連線中斷
**When** 系統偵測到連線中斷
**Then** 系統自動嘗試重新建立 WebSocket 連線（NFR33）
**And** WebSocket 連線恢復：連線中斷時自動重連，確保資料不遺失（NFR33）
**And** 系統在重連期間暫存操作（離線功能）
**And** 連線恢復後自動同步暫存的操作（NFR32）

### Story 7.9: WebSocket 失敗時的降級方案

As a 系統,
I want 在 WebSocket 失敗時提供降級方案,
So that 系統在 WebSocket 不可用時仍能運作。

**Acceptance Criteria:**

**Given** 系統無法建立或維持 WebSocket 連線
**When** WebSocket 連線失敗
**Then** 系統提供降級方案（如輪詢）（NFR35）
**And** 降級方案：WebSocket 失敗時提供降級方案（如輪詢）（NFR35）
**And** 系統透過降級方案維持資料同步
**And** 系統在 WebSocket 恢復後自動切換回 WebSocket 連線

## Epic 8: 後台管理功能擴充

後台管理員可以查看退貨單列表、查詢倉儲收貨資訊、同步查看前台資料、修改前台資料等管理功能。

**FRs covered:** FR68, FR69, FR70, FR71

### Story 8.1: 後台管理員可以查看退貨單列表

As a 後台管理員,
I want 在後台查看退貨單列表,
So that 我可以管理所有退貨單資料。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「碼頭管理 > 退貨單列表」頁面
**Then** 系統顯示所有退貨單列表（FR68）
**And** 列表顯示退貨單的關鍵資訊（退貨單號、建立日期、原配送單號、客戶簡稱、退貨類型、狀態等）
**And** 系統整合運務 APP 和後台產生的退貨單資料
**And** API 響應時間 < 300ms（NFR1）

### Story 8.2: 後台管理員可以查詢倉儲收貨資訊

As a 後台管理員,
I want 查詢倉儲收貨資訊,
So that 我可以了解所有收貨作業的詳細資訊。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「倉儲收貨管理 > 倉儲收貨資訊查詢」頁面
**Then** 系統顯示倉儲收貨資訊查詢功能（FR69）
**And** 系統可以查詢所有收貨作業的詳細資訊（收貨列表、配送點總表、收貨明細等）
**And** 系統連動前台資料顯示，可同步查看修改資料
**And** 查詢響應時間 < 1 秒（NFR12）

### Story 8.3: 後台管理員可以同步查看前台資料

As a 後台管理員,
I want 同步查看前台資料,
So that 我可以即時了解前台的作業狀況。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 查看任何前台相關資料（出貨作業、收貨作業、退貨作業等）
**Then** 系統同步查看前台資料（FR70）
**And** 系統即時同步，後台操作即時反映在前端
**And** 前台操作即時反映在後台
**And** 多裝置同步延遲 < 3 秒（NFR8）

### Story 8.4: 後台管理員可以修改前台資料（依照權限）

As a 後台管理員,
I want 修改前台資料（依照權限）,
So that 我可以協助處理前台的異常情況或資料修正。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統，具有相應權限
**When** 嘗試修改前台資料
**Then** 系統驗證後台管理員的權限（FR71）
**And** 如果具有權限，系統允許修改前台資料
**And** 如果沒有權限，系統顯示錯誤提示並阻止操作
**And** 修改後的資料即時同步到前台（< 3 秒）（NFR5）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 8.5: 後台管理員可以在區塊內容管理中新增「碼頭-忘記密碼」功能

As a 後台管理員,
I want 在區塊內容管理中新增「碼頭-忘記密碼」功能,
So that 我可以設定前台忘記密碼頁面顯示的提示文字。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「網站管理 > 區塊內容管理」頁面
**Then** 系統顯示新增的「碼頭-忘記密碼」功能選項
**And** 後台管理員可以編輯「碼頭-忘記密碼」的提示文字
**And** 編輯後的提示文字即時串聯到前台忘記密碼頁面顯示（Epic 2）
**And** 操作記錄被記錄（為 Epic 9 做準備）

### Story 8.6: 後台管理員可以在內部廠區編輯頁新增「入庫分貨配送點燈箱」

As a 後台管理員,
I want 在內部廠區編輯頁新增「入庫分貨配送點燈箱」,
So that 我可以設定內部廠區關聯的入庫分貨配送點。

**Acceptance Criteria:**

**Given** 後台管理員已登入後台系統
**When** 進入「配送點管理 > 內部廠區」編輯頁面
**Then** 系統顯示新增的「入庫分貨配送點燈箱」功能
**And** 後台管理員可以選擇與所選內部廠區關聯的入庫分貨配送點
**And** 設定的關聯關係用於收貨作業自動判斷收貨明細類型（Epic 5）
**And** 操作記錄被記錄（為 Epic 9 做準備）

## Epic 9: 資料整合與審計

系統可以與現有後台系統整合資料，記錄所有狀態變更操作，確保資料一致性與可追溯性。

**FRs covered:** FR72, FR73, FR74, FR75, FR76

### Story 9.1: 系統可以與現有後台系統整合資料

As a 系統,
I want 與現有後台系統整合資料,
So that 資料來源統一，確保系統間資料一致性。

**Acceptance Criteria:**

**Given** 系統需要存取或更新資料
**When** 系統進行資料操作
**Then** 系統與現有後台系統整合資料（FR72）
**And** 系統整合現有後台系統架構（Laravel MVC、Models、Services、Routes）
**And** 系統遵循現有 API 設計模式（TransportApi 等現有 API 結構）
**And** 系統整合現有資料模型（DeliveryOrder、DeliveryTask、Vehicle 等）
**And** 後台系統整合：與現有後台系統完整整合資料（NFR36）
**And** 資料格式相容：確保與現有系統的資料格式相容（NFR42）

### Story 9.2: 系統可以確保與現有系統的資料同步準確率 100%

As a 系統,
I want 確保與現有系統的資料同步準確率 100%,
So that 所有系統的資料保持一致。

**Acceptance Criteria:**

**Given** 系統進行資料同步操作
**When** 資料在系統間同步
**Then** 系統確保與現有系統的資料同步準確率 100%（FR73）
**And** 與現有系統資料同步準確率：100%（NFR28）
**And** 資料一致性：確保所有整合系統的資料同步一致（NFR44）
**And** 資料遺失率：0%（NFR29）

### Story 9.3: 系統可以記錄所有狀態變更操作

As a 系統,
I want 記錄所有狀態變更操作,
So that 我可以追蹤所有重要的操作記錄。

**Acceptance Criteria:**

**Given** 系統發生狀態變更操作（如車輛狀態變更、收貨狀態變更等）
**When** 操作執行
**Then** 系統記錄所有狀態變更操作（FR74）
**And** 操作記錄：記錄所有狀態變更操作（NFR22）
**And** 記錄包含操作時間、操作人員、操作內容、操作前後狀態等資訊
**And** 記錄儲存至資料庫，確保可查詢

### Story 9.4: 系統可以追溯所有操作的歷史記錄

As a 後台管理員,
I want 追溯所有操作的歷史記錄,
So that 我可以了解資料變更的完整歷程。

**Acceptance Criteria:**

**Given** 後台管理員需要查看操作歷史記錄
**When** 查詢特定資料的操作歷史
**Then** 系統追溯所有操作的歷史記錄（FR75）
**And** 審計日誌：可追溯所有操作的歷史記錄（NFR23）
**And** 系統顯示完整的操作歷史（時間、人員、操作內容、狀態變更等）
**And** 查詢響應時間 < 1 秒（NFR12）

### Story 9.5: 系統可以驗證資料完整性

As a 系統,
I want 驗證資料完整性,
So that 我可以確保資料的正確性和一致性。

**Acceptance Criteria:**

**Given** 系統進行資料操作或同步
**When** 資料寫入或更新
**Then** 系統驗證資料完整性（FR76）
**And** 資料完整性：100%（NFR30）
**And** 系統驗證必填欄位、資料格式、關聯資料完整性等
**And** 如果資料不完整，系統顯示錯誤提示並阻止操作
**And** 資料完整性驗證在資料庫層級和應用層級實作
